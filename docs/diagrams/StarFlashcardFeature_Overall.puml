@startuml
title Star Flashcard Sequence Diagram (with Garbage Collector)

actor User
participant Ui
participant Parser
participant StarCommand
participant FlashcardList
participant Flashcard
participant Storage
participant "Garbage Collector" as GC

User -> Ui : Inputs "star <index>"
activate Ui

Ui -> Parser : parseCommand("star <index>")
activate Parser
Parser -> StarCommand : new StarCommand(index)
activate StarCommand
Parser --> Ui : returns StarCommand object
deactivate Parser

Ui -> StarCommand : execute(flashcards, storage)
activate StarCommand

StarCommand -> FlashcardList : getFlashcard(index)
activate FlashcardList
FlashcardList --> StarCommand : returns Flashcard
deactivate FlashcardList

StarCommand -> Flashcard : isStarred()
activate Flashcard
Flashcard --> StarCommand : returns boolean
deactivate Flashcard

alt Flashcard not starred
    StarCommand -> Flashcard : toggleStar()
    activate Flashcard
    deactivate Flashcard

    StarCommand -> FlashcardList : addStarredFlashcard(flashcard)
    activate FlashcardList
    deactivate FlashcardList

    StarCommand -> Storage : save(flashcards)
    activate Storage
    deactivate Storage

    StarCommand -> Ui : showStarredFlashcard(flashcard)
    activate Ui
    deactivate Ui

else Flashcard already starred
    StarCommand -> Ui : showFlashcardAlreadyStarred()
    activate Ui
    deactivate Ui
end

deactivate StarCommand
deactivate Ui

' --- Object cleanup phase ---
Ui -> GC : StarCommand object no longer referenced
activate GC
GC -> StarCommand : mark object for collection
deactivate GC

@enduml
